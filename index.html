<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Homophonic Cipher</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: var(--secondary);
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            color: var(--light);
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary);
            display: flex;
            align-items: center;
        }
        
        h2 i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light);
        }
        
        textarea, input, select {
            width: 100%;
            padding: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }
        
        button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        button i {
            margin-right: 8px;
        }
        
        .btn-encrypt {
            background: var(--success);
        }
        
        .btn-encrypt:hover {
            background: #27ae60;
        }
        
        .btn-decrypt {
            background: var(--accent);
        }
        
        .btn-decrypt:hover {
            background: #c0392b;
        }
        
        .key-settings {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .key-display {
            font-family: monospace;
            word-break: break-all;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
        
        .algorithm-explanation {
            padding: 25px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
        }
        
        .explanation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .explanation-content {
                grid-template-columns: 1fr;
            }
        }
        
        .math-expression {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
            line-height: 1.8;
        }
        
        .flex-row {
            display: flex;
            gap: 15px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        .prime-input {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
        }
        
        .icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
        }
        
        .status.success {
            background: rgba(46, 204, 113, 0.2);
            border-left: 4px solid var(--success);
            display: block;
        }
        
        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid var(--accent);
            display: block;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--secondary);
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--dark);
            color: var(--light);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .output-group {
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Homophonic Cipher</h1>
            <p class="subtitle">A professional implementation of a mathematically secure homophonic substitution cipher with multiple ciphertext representations for each plaintext character</p>
        </header>
        
        <div class="key-settings">
            <h2><span class="icon">‚öôÔ∏è</span> Cipher Settings</h2>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="alphabet">Character Set <span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Define all characters that will be used in encryption</span></span></label>
                    <input type="text" id="alphabet" valueABCDEFGHIJKLMNOPQRSTUVWXYZ">
                </div>
                <div class="form-group">
                    <label for="prime">Prime Modulus (p) <span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Large prime number for modular arithmetic</span></span></label>
                    <div class="flex-row">
                        <input type="number" id="prime" value="1009">
                        <button onclick="generatePrime()">Generate</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="generator">Generator (g) <span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Primitive root modulo p</span></span></label>
                    <div class="flex-row">
                        <input type="number" id="generator" value="7">
                        <button onclick="findGenerator()">Find</button>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Character Mapping</label>
                <div class="key-display" id="alphabet-mapping">A=1, B=2, C=3, D=4, E=5, F=6, G=7, H=8, I=9, J=10, K=11, L=12, M=13, N=14, O=15, P=16, Q=17, R=18, S=19, T=20, U=21, V=22, W=23, X=24, Y=25, Z=26</div>
            </div>
        </div>
        
        <div class="app-container">
            <div class="panel">
                <h2><span class="icon">üîí</span> Encryption</h2>
                <div class="form-group">
                    <label for="plaintext">Plaintext</label>
                    <textarea id="plaintext" placeholder="Enter text to encrypt">PROFESSIONAL HOMOPHONIC CIPHER IMPLEMENTATION</textarea>
                </div>
                <div class="action-buttons">
                    <button class="btn-encrypt" onclick="encrypt()"><span class="icon">‚ñ∂Ô∏è</span> Encrypt</button>
                    <button onclick="document.getElementById('plaintext').value = ''">Clear</button>
                </div>
                <div class="form-group">
                    <label for="ciphertext">Ciphertext (Pairs)</label>
                    <div class="output-group">
                        <textarea id="ciphertext" placeholder="Encrypted text will appear here" readonly></textarea>
                        <button class="copy-btn" onclick="copyToClipboard('ciphertext')">Copy</button>
                    </div>
                </div>
                <div id="encrypt-status" class="status"></div>
            </div>
            
            <div class="panel">
                <h2><span class="icon">üîì</span> Decryption</h2>
                <div class="form-group">
                    <label for="input-ciphertext">Ciphertext (Pairs)</label>
                    <textarea id="input-ciphertext" placeholder="Paste ciphertext pairs here"></textarea>
                </div>
                <div class="action-buttons">
                    <button class="btn-decrypt" onclick="decrypt()"><span class="icon">‚ñ∂Ô∏è</span> Decrypt</button>
                    <button onclick="document.getElementById('input-ciphertext').value = ''">Clear</button>
                </div>
                <div class="form-group">
                    <label for="decrypted">Decrypted Text</label>
                    <div class="output-group">
                        <textarea id="decrypted" placeholder="Decrypted text will appear here" readonly></textarea>
                        <button class="copy-btn" onclick="copyToClipboard('decrypted')">Copy</button>
                    </div>
                </div>
                <div id="decrypt-status" class="status"></div>
            </div>
        </div>
        
        <div class="algorithm-explanation">
            <h2><span class="icon">üß†</span> Algorithm Explanation</h2>
            <div class="explanation-content">
                <div>
                    <h3>Encryption Process</h3>
                    <p>For each character in the plaintext:</p>
                    <ol>
                        <li>Convert character to numerical value m (position in alphabet)</li>
                        <li>Generate a cryptographically secure random number k</li>
                        <li>Compute a = g<sup>k</sup> mod p</li>
                        <li>Compute b = m √ó (g<sup>m</sup>)<sup>k</sup> mod p = m √ó g<sup>m√ók</sup> mod p</li>
                        <li>The ciphertext is the pair (a, b)</li>
                    </ol>
                    <div class="math-expression">
                        Ciphertext = (g<sup>k</sup> mod p, m √ó g<sup>m√ók</sup> mod p)
                    </div>
                </div>
                <div>
                    <h3>Decryption Process</h3>
                    <p>For each ciphertext pair (a, b):</p>
                    <ol>
                        <li>For each possible character value m in alphabet:</li>
                        <li>Compute a<sup>m</sup> mod p</li>
                        <li>Check if b ‚â° m √ó a<sup>m</sup> mod p</li>
                        <li>When match is found, convert m back to character</li>
                    </ol>
                    <div class="math-expression">
                        For each m in alphabet: check if b ‚â° m √ó a<sup>m</sup> mod p
                    </div>
                    <p>The decryption requires trying all possible m values, which is efficient for standard alphabets.</p>
                </div>
            </div>
            <div class="math-expression">
                <strong>Why this works:</strong> a<sup>m</sup> ‚â° (g<sup>k</sup>)<sup>m</sup> ‚â° g<sup>k√óm</sup> mod p, and b = m √ó g<sup>m√ók</sup> mod p, so b ‚â° m √ó a<sup>m</sup> mod p
            </div>
        </div>
    </div>

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateAlphabetMapping();
            document.getElementById('prime').addEventListener('input', updateAlphabetMapping);
            document.getElementById('alphabet').addEventListener('input', updateAlphabetMapping);
        });
        
        // Update the alphabet mapping display
        function updateAlphabetMapping() {
            const alphabet = document.getElementById('alphabet').value;
            const prime = parseInt(document.getElementById('prime').value);
            let mapping = '';
            
            for (let i = 0; i < alphabet.length; i++) {
                const char = alphabet[i];
                const value = i + 1;
                if (value >= prime) {
                    showStatus('error', 'Prime must be larger than alphabet size', 'encrypt-status');
                    break;
                }
                mapping += `${char}=${value}`;
                if (i < alphabet.length - 1) mapping += ', ';
                if (i > 0 && i % 10 === 0) mapping += '\n';
            }
            
            document.getElementById('alphabet-mapping').textContent = mapping;
        }
        
        // Show status message
        function showStatus(type, message, elementId) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'status ' + type;
            
            // Clear status after 5 seconds
            setTimeout(() => {
                element.className = 'status';
                element.textContent = '';
            }, 5000);
        }
        
        // Copy text to clipboard
        function copyToClipboard(elementId) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            document.execCommand('copy');
            showStatus('success', 'Copied to clipboard', elementId + '-status');
        }
        
        // Generate a large prime number
        function generatePrime() {
            // In a real application, this would generate a much larger prime
            // For demonstration, we'll use a precomputed list of primes
            const primes = [101, 211, 307, 401, 503, 601, 701, 809, 907, 1009, 
                            1103, 1201, 1301, 1409, 1511, 1601, 1709, 1801, 1901, 2003];
            const randomPrime = primes[Math.floor(Math.random() * primes.length)];
            document.getElementById('prime').value = randomPrime;
            updateAlphabetMapping();
            showStatus('success', `Generated prime: ${randomPrime}`, 'encrypt-status');
        }
        
        // Find a generator for the current prime
        function findGenerator() {
            const p = parseInt(document.getElementById('prime').value);
            if (!p || p < 2) {
                showStatus('error', 'Please enter a valid prime number', 'encrypt-status');
                return;
            }
            
            // Simple algorithm to find a generator
            // In real applications, more sophisticated methods would be used
            for (let g = 2; g < p; g++) {
                if (isGenerator(g, p)) {
                    document.getElementById('generator').value = g;
                    showStatus('success', `Found generator: ${g}`, 'encrypt-status');
                    return;
                }
            }
            
            showStatus('error', 'No generator found for this prime', 'encrypt-status');
        }
        
        // Check if g is a generator modulo p
        function isGenerator(g, p) {
            // This is a simplified check - not efficient for very large primes
            const seen = new Set();
            let current = 1;
            
            for (let i = 1; i < p; i++) {
                current = (current * g) % p;
                if (seen.has(current)) return false;
                seen.add(current);
            }
            
            return true;
        }
        
        // Modular exponentiation: (base^exponent) % modulus
        function modExp(base, exponent, modulus) {
            if (modulus === 1) return 0;
            
            let result = 1;
            base = base % modulus;
            
            while (exponent > 0) {
                if (exponent % 2 === 1) {
                    result = (result * base) % modulus;
                }
                exponent = Math.floor(exponent / 2);
                base = (base * base) % modulus;
            }
            
            return result;
        }
        
        // Get cryptographically secure random values
        function getCryptoRandom() {
            const array = new Uint32Array(1);
            window.crypto.getRandomValues(array);
            return array[0] / (0xFFFFFFFF + 1);
        }
        
        // Encrypt function
        function encrypt() {
            const plaintext = document.getElementById('plaintext').value.toUpperCase();
            const alphabet = document.getElementById('alphabet').value.toUpperCase();
            const p = parseInt(document.getElementById('prime').value);
            const g = parseInt(document.getElementById('generator').value);
            
            if (!p || !g) {
                showStatus('error', 'Please enter valid prime and generator values', 'encrypt-status');
                return;
            }
            
            if (p <= alphabet.length) {
                showStatus('error', 'Prime must be larger than alphabet size', 'encrypt-status');
                return;
            }
            
            let ciphertext = '';
            
            for (let i = 0; i < plaintext.length; i++) {
                const char = plaintext[i];
                const index = alphabet.indexOf(char);
                
                if (index === -1) {
                    // Character not in alphabet, leave as is
                    ciphertext += char + ' ';
                    continue;
                }
                
                // Character value (1-indexed)
                const m = index + 1;
                
                // Generate cryptographically secure random k for each character (1 < k < p-1)
                const k = Math.floor(getCryptoRandom() * (p - 2)) + 2;
                
                // Compute a = g^k mod p
                const a = modExp(g, k, p);
                
                // Compute b = m * (g^m)^k mod p = m * g^(m*k) mod p
                const gmk = modExp(g, m * k, p);
                const b = (m * gmk) % p;
                
                // Append the pair (a, b) to the ciphertext
                ciphertext += `(${a},${b}) `;
            }
            
            document.getElementById('ciphertext').value = ciphertext.trim();
            showStatus('success', 'Encryption completed successfully', 'encrypt-status');
        }
        
        // Decrypt function
        function decrypt() {
            const ciphertext = document.getElementById('input-ciphertext').value;
            const alphabet = document.getElementById('alphabet').value.toUpperCase();
            const p = parseInt(document.getElementById('prime').value);
            
            if (!p) {
                showStatus('error', 'Please enter a valid prime value', 'decrypt-status');
                return;
            }
            
            let decrypted = '';
            
            // Split ciphertext into pairs
            const pairs = ciphertext.match(/\(\d+,\d+\)/g) || [];
            
            for (const pair of pairs) {
                // Extract a and b values from the pair
                const match = pair.match(/\((\d+),(\d+)\)/);
                if (!match) {
                    decrypted += '?';
                    continue;
                }
                
                const a = parseInt(match[1]);
                const b = parseInt(match[2]);
                
                // Try each possible character value to find the correct one
                let found = false;
                for (let m = 1; m <= alphabet.length; m++) {
                    // Compute a^m mod p
                    const am = modExp(a, m, p);
                    
                    // Check if b ‚â° m * a^m mod p
                    if (b === (m * am) % p) {
                        decrypted += alphabet[m - 1];
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    decrypted += '?';
                }
            }
            
            document.getElementById('decrypted').value = decrypted;
            showStatus('success', 'Decryption completed successfully', 'decrypt-status');
        }
    </script>
</body>
</html>
