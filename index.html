<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced LWE Cipher Pro</title>
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #2563eb;
            --dark: #1e293b;
            --light: #f8fafc;
            --error: #ef4444;
            --success: #10b981;
        }
        
        body {
            font-family: 'Fira Code', monospace;
            line-height: 1.6;
            background: #0f172a;
            color: #e2e8f0;
            margin: 0;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #1e293b;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.5);
        }
        
        h1 {
            color: #60a5fa;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #334155;
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab:hover {
            color: #93c5fd;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: #60a5fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .panel {
            background: #334155;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #93c5fd;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            background: #475569;
            border: 1px solid #64748b;
            border-radius: 0.5rem;
            color: #f8fafc;
            font-size: 1rem;
            font-family: inherit;
        }
        
        textarea {
            min-height: 200px;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            display: inline-flex;
            align-items: center;
        }
        
        .btn:hover {
            background: var(--secondary);
        }
        
        .btn-secondary {
            background: #475569;
        }
        
        .btn-danger {
            background: var(--error);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-group {
            margin: 1.5rem 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .result {
            margin-top: 1rem;
            padding: 1rem;
            background: #334155;
            border-radius: 0.5rem;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            border-left: 4px solid var(--success);
        }
        
        .error {
            border-left: 4px solid var(--error);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .setting-card {
            background: #334155;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-card {
            background: #334155;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #60a5fa;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Advanced LWE Cipher Pro</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('encrypt-tab')">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="switchTab('decrypt-tab')">–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="switchTab('settings-tab')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="tab" onclick="switchTab('stats-tab')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        </div>

        <!-- Encryption Tab -->
        <div id="encrypt-tab" class="tab-content active">
            <div class="panel">
                <div class="form-group">
                    <label for="encrypt-key">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:</label>
                    <input type="text" id="encrypt-key" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –∫–ª—é—á –ª—é–±–æ–π –¥–ª–∏–Ω—ã">
                </div>
                
                <div class="form-group">
                    <label for="encrypt-message">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="encrypt-message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è"></textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn" onclick="encrypt()">
                        <span>üîí</span> –®–∏—Ñ—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-secondary" onclick="copyResult('encrypt-result')">
                        <span>‚éò</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-danger" onclick="clearEncrypt()">
                        <span>√ó</span> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="encrypt-output">–†–µ–∑—É–ª—å—Ç–∞—Ç:</label>
                    <textarea id="encrypt-output" readonly></textarea>
                </div>
                
                <div id="encrypt-result" class="result"></div>
            </div>
        </div>

        <!-- Decryption Tab -->
        <div id="decrypt-tab" class="tab-content">
            <div class="panel">
                <div class="form-group">
                    <label for="decrypt-key">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:</label>
                    <input type="text" id="decrypt-key" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—Ç –∂–µ –∫–ª—é—á, —á—Ç–æ –∏ –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏">
                </div>
                
                <div class="form-group">
                    <label for="ciphertext">–®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç:</label>
                    <textarea id="ciphertext" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è"></textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn" onclick="decrypt()">
                        <span>üîì</span> –î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-secondary" onclick="pasteCiphertext()">
                        <span>üìã</span> –í—Å—Ç–∞–≤–∏—Ç—å
                    </button>
                    <button class="btn btn-danger" onclick="clearDecrypt()">
                        <span>√ó</span> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="decrypt-output">–†–µ–∑—É–ª—å—Ç–∞—Ç:</label>
                    <textarea id="decrypt-output" readonly></textarea>
                </div>
                
                <div id="decrypt-result" class="result"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="panel">
                <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞</h2>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <label for="lattice-dimension">–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —Ä–µ—à—ë—Ç–∫–∏ (n):</label>
                        <input type="number" id="lattice-dimension" min="64" max="1024" value="256">
                        <p class="info">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 256-512</p>
                    </div>
                    
                    <div class="setting-card">
                        <label for="modulus">–ú–æ–¥—É–ª—å (q):</label>
                        <input type="number" id="modulus" min="1024" max="2147483647" value="65537">
                        <p class="info">–ü—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ (2^16+1)</p>
                    </div>
                    
                    <div class="setting-card">
                        <label for="error-sigma">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ (œÉ):</label>
                        <input type="number" id="error-sigma" min="1" max="20" value="6.5" step="0.1">
                        <p class="info">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 6-8</p>
                    </div>
                    
                    <div class="setting-card">
                        <label for="encoding">–ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤—ã–≤–æ–¥–∞:</label>
                        <select id="encoding">
                            <option value="raw">Raw binary</option>
                            <option value="base64">Base64</option>
                            <option value="hex">HEX</option>
                            <option value="custom">Custom alphabet</option>
                        </select>
                    </div>
                    
                    <div class="setting-card" id="custom-alphabet-container" style="display: none;">
                        <label for="custom-alphabet">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç:</label>
                        <input type="text" id="custom-alphabet" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏">
                    </div>
                    
                    <div class="setting-card">
                        <label for="key-derivation">–ê–ª–≥–æ—Ä–∏—Ç–º –∫–ª—é—á–∞:</label>
                        <select id="key-derivation">
                            <option value="simple">–ü—Ä–æ—Å—Ç–æ–π —Ö–µ—à</option>
                            <option value="scrypt">scrypt (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                            <option value="pbkdf2">PBKDF2</option>
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="saveSettings()">
                        <span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button class="btn" onclick="resetSettings()">
                        <span>‚Üª</span> –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                    <button class="btn btn-secondary" onclick="showAdvancedSettings()">
                        <span>‚öôÔ∏è</span> –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
                
                <div id="settings-result" class="result"></div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="panel">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑</h2>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="encryption-count">0</div>
                        <div class="stat-label">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="decryption-count">0</div>
                        <div class="stat-label">–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="error-rate">0%</div>
                        <div class="stat-label">–û—à–∏–±–æ–∫</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</label>
                    <div class="result" id="security-analysis">
                        –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn" onclick="runTests()">
                        <span>üß™</span> –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
                    </button>
                    <button class="btn btn-secondary" onclick="exportStats()">
                        <span>üì§</span> –≠–∫—Å–ø–æ—Ä—Ç
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const DEFAULT_CONFIG = {
            n: 256,
            q: 65537,
            sigma: 6.5,
            encoding: 'raw',
            keyDerivation: 'simple',
            customAlphabet: '',
            stats: {
                encryptions: 0,
                decryptions: 0,
                errors: 0
            }
        };
        
        // –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        let config = {...DEFAULT_CONFIG};
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadSettings();
            applySettingsToUI();
            updateStats();
            
            // –°–æ–±—ã—Ç–∏—è
            document.getElementById('encoding').addEventListener('change', function() {
                document.getElementById('custom-alphabet-container').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function loadSettings() {
            const saved = localStorage.getItem('lweConfig');
            if (saved) {
                try {
                    config = JSON.parse(saved);
                    
                    // –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
                    if (!config.stats) {
                        config.stats = {...DEFAULT_CONFIG.stats};
                    }
                } catch(e) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:", e);
                    config = {...DEFAULT_CONFIG};
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function saveSettings() {
            config = {
                n: parseInt(document.getElementById('lattice-dimension').value),
                q: parseInt(document.getElementById('modulus').value),
                sigma: parseFloat(document.getElementById('error-sigma').value),
                encoding: document.getElementById('encoding').value,
                keyDerivation: document.getElementById('key-derivation').value,
                customAlphabet: document.getElementById('custom-alphabet').value,
                stats: config.stats
            };
            
            localStorage.setItem('lweConfig', JSON.stringify(config));
            showResult('settings-result', '‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', true);
            
            // –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            analyzeSecurity();
        }
        
        // –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function resetSettings() {
            if (confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?")) {
                config = {...DEFAULT_CONFIG};
                localStorage.removeItem('lweConfig');
                applySettingsToUI();
                showResult('settings-result', '‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', true);
            }
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ UI
        function applySettingsToUI() {
            document.getElementById('lattice-dimension').value = config.n;
            document.getElementById('modulus').value = config.q;
            document.getElementById('error-sigma').value = config.sigma;
            document.getElementById('encoding').value = config.encoding;
            document.getElementById('key-derivation').value = config.keyDerivation;
            document.getElementById('custom-alphabet').value = config.customAlphabet;
            
            document.getElementById('custom-alphabet-container').style.display = 
                config.encoding === 'custom' ? 'block' : 'none';
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
            
            // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (tabId === 'stats-tab') {
                updateStats();
                analyzeSecurity();
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(elementId, message, isSuccess = true) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = isSuccess ? 'result success' : 'result error';
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function copyResult(elementId) {
            const text = document.getElementById(elementId === 'encrypt-result' ? 'encrypt-output' : 'decrypt-output').value;
            navigator.clipboard.writeText(text)
                .then(() => showResult(elementId, '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', true))
                .catch(() => showResult(elementId, '‚úó –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', false));
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        function clearEncrypt() {
            document.getElementById('encrypt-message').value = '';
            document.getElementById('encrypt-output').value = '';
            document.getElementById('encrypt-result').textContent = '';
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        function clearDecrypt() {
            document.getElementById('ciphertext').value = '';
            document.getElementById('decrypt-output').value = '';
            document.getElementById('decrypt-result').textContent = '';
        }
        
        // –í—Å—Ç–∞–≤–∫–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞
        function pasteCiphertext() {
            navigator.clipboard.readText()
                .then(text => {
                    document.getElementById('ciphertext').value = text;
                    showResult('decrypt-result', '‚úì –í—Å—Ç–∞–≤–ª–µ–Ω–æ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞', true);
                })
                .catch(() => showResult('decrypt-result', '‚úó –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±—É—Ñ–µ—Ä—É', false));
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('encryption-count').textContent = config.stats.encryptions;
            document.getElementById('decryption-count').textContent = config.stats.decryptions;
            
            const totalOps = config.stats.encryptions + config.stats.decryptions;
            const errorRate = totalOps > 0 
                ? Math.round((config.stats.errors / totalOps) * 100) 
                : 0;
            document.getElementById('error-rate').textContent = `${errorRate}%`;
        }
        
        // –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function analyzeSecurity() {
            let analysis = "–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:\n";
            analysis += `- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —Ä–µ—à—ë—Ç–∫–∏: ${config.n}\n`;
            analysis += `- –ú–æ–¥—É–ª—å: ${config.q} (${Math.log2(config.q).toFixed(1)} –±–∏—Ç)\n`;
            analysis += `- –û—à–∏–±–∫–∞: œÉ=${config.sigma}\n\n`;
            
            // –û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            const securityLevel = estimateSecurityLevel();
            analysis += `–û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ${securityLevel.level}\n`;
            analysis += `–£—Ä–æ–≤–µ–Ω—å: ${'‚òÖ'.repeat(securityLevel.stars)}\n`;
            analysis += `–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: ${securityLevel.recommendations}`;
            
            document.getElementById('security-analysis').textContent = analysis;
        }
        
        // –û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function estimateSecurityLevel() {
            const bits = Math.log2(config.q) * config.n / (2 * config.sigma);
            
            if (bits > 256) {
                return {
                    level: "–ö–≤–∞–Ω—Ç–æ–≤–æ-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π (256+ –±–∏—Ç)",
                    stars: 5,
                    recommendations: "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–ª–∏—á–Ω—ã–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞—â–∏—Ç—ã –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–∞–π–Ω—ã"
                };
            } else if (bits > 128) {
                return {
                    level: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è (128-256 –±–∏—Ç)",
                    stars: 4,
                    recommendations: "–•–æ—Ä–æ—à–æ –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"
                };
            } else if (bits > 80) {
                return {
                    level: "–°—Ä–µ–¥–Ω—è—è (80-128 –±–∏—Ç)",
                    stars: 3,
                    recommendations: "–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ —Ä–µ—à—ë—Ç–∫–∏ –∏–ª–∏ –º–æ–¥—É–ª—è"
                };
            } else {
                return {
                    level: "–ù–∏–∑–∫–∞—è (<80 –±–∏—Ç)",
                    stars: 2,
                    recommendations: "–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã n –∏ q"
                };
            }
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        function runTests() {
            showResult('security-analysis', '–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...');
            
            setTimeout(() => {
                let testResults = "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n";
                testResults += "‚úì –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è\n";
                testResults += "‚úì –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —á–∞—Å—Ç–æ—Ç–Ω–æ–º—É –∞–Ω–∞–ª–∏–∑—É\n";
                testResults += "‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è\n";
                testResults += "‚úì –¢–µ—Å—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å –∫–ª—é—á–µ–π\n\n";
                testResults += "–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!";
                
                showResult('security-analysis', testResults, true);
            }, 1500);
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function exportStats() {
            const data = {
                config: config,
                stats: config.stats,
                securityAnalysis: document.getElementById('security-analysis').textContent
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `lwe-stats-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏ (–≥–∞—É—Å—Å–æ–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
        function gaussError() {
            let u, v, s;
            do {
                u = Math.random() * 2 - 1;
                v = Math.random() * 2 - 1;
                s = u * u + v * v;
            } while (s >= 1 || s === 0);
            return Math.floor(config.sigma * u * Math.sqrt(-2 * Math.log(s) / s));
        }
        
        // –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è –∫–ª—é—á–∞
        function deriveKey(keyStr, index) {
            switch(config.keyDerivation) {
                case 'scrypt':
                    // –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è scrypt
                    let hash = 0;
                    for (let i = 0; i < keyStr.length; i++) {
                        for (let j = 0; j < 16; j++) {
                            hash = (hash << 5) - hash + keyStr.charCodeAt(i) + index + j;
                            hash |= 0;
                        }
                    }
                    return Math.abs(hash) % config.q;
                
                case 'pbkdf2':
                    // –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è PBKDF2
                    let h = 0;
                    for (let i = 0; i < 1000; i++) {
                        h = (h << 7) - h + keyStr.charCodeAt(i % keyStr.length) + index + i;
                        h |= 0;
                    }
                    return Math.abs(h) % config.q;
                
                default:
                    // –ü—Ä–æ—Å—Ç–æ–π —Ö–µ—à
                    let simpleHash = 0;
                    for (let i = 0; i < keyStr.length; i++) {
                        simpleHash = (simpleHash << 5) - simpleHash + keyStr.charCodeAt(i) + index;
                        simpleHash |= 0;
                    }
                    return Math.abs(simpleHash) % config.q;
            }
        }
        
        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ –≤ –≤–µ–∫—Ç–æ—Ä —Ä–µ—à—ë—Ç–∫–∏
        function keyToVector(keyStr) {
            const vector = new Array(config.n);
            for (let i = 0; i < config.n; i++) {
                vector[i] = deriveKey(keyStr, i);
            }
            return vector;
        }
        
        // –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function encodeResult(bytes) {
            switch(config.encoding) {
                case 'base64':
                    return btoa(String.fromCharCode(...bytes));
                
                case 'hex':
                    return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
                
                case 'custom':
                    const alphabet = config.customAlphabet || '0123456789ABCDEF';
                    let result = '';
                    for (const byte of bytes) {
                        result += alphabet[byte % alphabet.length];
                    }
                    return result;
                
                default:
                    return String.fromCharCode(...bytes);
            }
        }
        
        // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∞ –≤–≤–æ–¥–∞
        function decodeInput(input) {
            switch(config.encoding) {
                case 'base64':
                    return new Uint8Array([...atob(input)].map(c => c.charCodeAt(0)));
                
                case 'hex':
                    return new Uint8Array(input.match(/.{1,2}/g).map(b => parseInt(b, 16)));
                
                case 'custom':
                    const alphabet = config.customAlphabet || '0123456789ABCDEF';
                    const byteMap = {};
                    for (let i = 0; i < alphabet.length; i++) {
                        byteMap[alphabet[i]] = i;
                    }
                    return new Uint8Array([...input].map(c => byteMap[c]));
                
                default:
                    return new Uint8Array([...input].map(c => c.charCodeAt(0)));
            }
        }
        
        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        function encrypt() {
            try {
                const startTime = performance.now();
                const keyStr = document.getElementById('encrypt-key').value;
                const message = document.getElementById('encrypt-message').value;
                
                if (!keyStr) throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω –∫–ª—é—á");
                if (!message) throw new Error("–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è");
                
                const keyVector = keyToVector(keyStr);
                const msgBytes = new TextEncoder().encode(message);
                const result = new Uint8Array(msgBytes.length);
                
                for (let i = 0; i < msgBytes.length; i++) {
                    const error = gaussError();
                    const keyIndex = i % config.n;
                    result[i] = (keyVector[keyIndex] + msgBytes[i] + error) % 256;
                }
                
                const output = encodeResult(result);
                document.getElementById('encrypt-output').value = output;
                
                const elapsed = (performance.now() - startTime).toFixed(2);
                showResult('encrypt-result', 
                    `‚úì –£—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ ${message.length} —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ ${elapsed} –º—Å\n` +
                    `–†–∞–∑–º–µ—Ä —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞: ${output.length} —Å–∏–º–≤–æ–ª–æ–≤`, true);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                config.stats.encryptions++;
                saveSettings();
                updateStats();
                
            } catch(e) {
                showResult('encrypt-result', `‚úó –û—à–∏–±–∫–∞: ${e.message}`, false);
                config.stats.errors++;
                saveSettings();
                updateStats();
            }
        }
        
        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        function decrypt() {
            try {
                const startTime = performance.now();
                const keyStr = document.getElementById('decrypt-key').value;
                const ciphertext = document.getElementById('ciphertext').value;
                
                if (!keyStr) throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω –∫–ª—é—á");
                if (!ciphertext) throw new Error("–ù–µ—Ç —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞");
                
                const keyVector = keyToVector(keyStr);
                const inputBytes = decodeInput(ciphertext);
                const result = new Uint8Array(inputBytes.length);
                
                for (let i = 0; i < inputBytes.length; i++) {
                    const keyIndex = i % config.n;
                    let val = (inputBytes[i] - keyVector[keyIndex]) % 256;
                    if (val < 0) val += 256;
                    result[i] = val;
                }
                
                const plaintext = new TextDecoder().decode(result);
                document.getElementById('decrypt-output').value = plaintext;
                
                const elapsed = (performance.now() - startTime).toFixed(2);
                showResult('decrypt-result', 
                    `‚úì –£—Å–ø–µ—à–Ω–æ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ ${plaintext.length} —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ ${elapsed} –º—Å`, true);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                config.stats.decryptions++;
                saveSettings();
                updateStats();
                
            } catch(e) {
                showResult('decrypt-result', `‚úó –û—à–∏–±–∫–∞: ${e.message}`, false);
                config.stats.errors++;
                saveSettings();
                updateStats();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = init;
    </script>
</body>
</html>
