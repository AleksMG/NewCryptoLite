<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lattice Encryption (LWE)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        textarea, button {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Lattice-Based Encryption (LWE)</h1>

    <!-- Key Generation -->
    <button id="generateKeys">Generate Keys</button>
    <div>Public Key: <span id="publicKey">Not generated</span></div>
    <div>Secret Key: <span id="secretKey">Not generated</span></div>

    <!-- Encryption -->
    <h2>Encrypt</h2>
    <textarea id="plaintext" placeholder="Enter message"></textarea>
    <button id="encryptBtn">Encrypt</button>

    <!-- Decryption -->
    <h2>Decrypt</h2>
    <textarea id="ciphertext" placeholder="Paste ciphertext here"></textarea>
    <button id="decryptBtn">Decrypt</button>
    <textarea id="decryptedText" placeholder="Decrypted message" readonly></textarea>

    <!-- Status Messages -->
    <div id="status"></div>

    <!-- Scripts -->
    <script src="lattice.js"></script>
    <script>
        // Main thread logic (UI)
        const crypto = new LatticeCrypto(64); // Smaller dimension for browser
        let keys = null;
        const worker = new Worker('worker.js');

        // Generate Keys
        document.getElementById('generateKeys').addEventListener('click', () => {
            worker.postMessage({ action: 'generateKeys' });
        });

        // Encrypt
        document.getElementById('encryptBtn').addEventListener('click', () => {
            if (!keys) {
                showStatus("Generate keys first!", "error");
                return;
            }
            const message = document.getElementById('plaintext').value;
            worker.postMessage({ 
                action: 'encrypt', 
                message, 
                publicKey: keys.publicKey 
            });
        });

        // Decrypt
        document.getElementById('decryptBtn').addEventListener('click', () => {
            if (!keys) {
                showStatus("Generate keys first!", "error");
                return;
            }
            const ciphertext = document.getElementById('ciphertext').value;
            worker.postMessage({ 
                action: 'decrypt', 
                ciphertext, 
                secretKey: keys.secretKey 
            });
        });

        // Handle worker responses
        worker.onmessage = function(e) {
            const { action, result, error } = e.data;
            if (error) {
                showStatus(error, "error");
                return;
            }

            switch (action) {
                case 'generateKeys':
                    keys = result;
                    document.getElementById('publicKey').textContent = 
                        `A: [...], b: [${result.publicKey.b.slice(0, 3)}...]`;
                    document.getElementById('secretKey').textContent = 
                        `[${result.secretKey.slice(0, 5)}...]`;
                    showStatus("Keys generated!", "success");
                    break;

                case 'encrypt':
                    document.getElementById('ciphertext').value = 
                        JSON.stringify(result);
                    showStatus("Encryption successful!", "success");
                    break;

                case 'decrypt':
                    document.getElementById('decryptedText').value = result;
                    showStatus("Decryption successful!", "success");
                    break;
            }
        };

        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = type;
        }
    </script>
</body>
</html>
